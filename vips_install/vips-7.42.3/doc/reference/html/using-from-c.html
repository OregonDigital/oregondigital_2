<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>VIPS Reference Manual: VIPS from C</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="index.html" title="VIPS Reference Manual">
<link rel="up" href="ch01.html" title="VIPS Overview">
<link rel="prev" href="using-cli.html" title="VIPS from the command-line">
<link rel="next" href="using-from-python.html" title="VIPS from Python">
<meta name="generator" content="GTK-Doc V1.20 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="10"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="using-cli.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="using-from-python.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry">
<a name="using-from-c"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle">VIPS from C</span></h2>
<p>Using VIPS — How to use the VIPS library from C</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1">
<a name="using-C-intro"></a><h2>Introduction</h2>
<p>
      VIPS comes with a convenient, high-level C API. You should read the API 
      docs for full details, but this section will try to give a brief 
      overview. The <span class="command"><strong>vips</strong></span> program is handy for getting a 
      summary of an operation's parameters.
    </p>
</div>
<div class="refsect1">
<a name="using-C-startup"></a><h2>Library startup</h2>
<p>
      When your program starts, use <a class="link" href="libvips-vips.html#VIPS-INIT:CAPS" title="VIPS_INIT()"><code class="function">VIPS_INIT()</code></a>
      to start up the VIPS library. You should pass it the name
      of your program, usually <code class="code">argv[0]</code>. Use
      <a class="link" href="libvips-vips.html#vips-shutdown" title="vips_shutdown ()"><code class="function">vips_shutdown()</code></a> when you exit.
    </p>
<p>
      You can add the VIPS flags to your <a href="http://library.gnome.org/devel/gobject/unstable/gobject-The-Base-Object-Type.html#GObject"><code class="literal">GObject</code></a> command-line processing
      with <a class="link" href="libvips-vips.html#vips-add-option-entries" title="vips_add_option_entries ()"><code class="function">vips_add_option_entries()</code></a>, see below.
    </p>
</div>
<div class="refsect1">
<a name="using-C-vipsimage"></a><h2>The <a class="link" href="VipsImage.html" title="VipsImage"><span class="type">VipsImage</span></a> class</h2>
<p>
      The basic data object is the <a class="link" href="VipsImage.html" title="VipsImage"><span class="type">VipsImage</span></a>. You can create an
      image from a file on disc or from an area of memory, either
      as a C-style array, or as a formatted object, like JPEG. See
      <a class="link" href="VipsImage.html#vips-image-new-from-file" title="vips_image_new_from_file ()"><code class="function">vips_image_new_from_file()</code></a> and friends.  Loading an
      image is fast: VIPS read just enough of the image to be able to get
      the various properties, such as width, but no decoding occurs until 
      pixel values are really needed.
    </p>
<p>
      Once you have an image, you can get properties from it in the usual way. 
      You can use projection functions, like <a class="link" href="libvips-header.html#vips-image-get-width" title="vips_image_get_width ()"><code class="function">vips_image_get_width()</code></a> or 
      <a href="http://library.gnome.org/devel/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-get"><code class="function">g_object_get()</code></a>, to get <a href="http://library.gnome.org/devel/gobject/unstable/gobject-The-Base-Object-Type.html#GObject"><code class="literal">GObject</code></a> properties. All VIPS objects are
      immutable, meaning you can only get properties, you can't set them.
      See <a class="link" href="libvips-header.html" title="header">VIPS Header</a> to read about 
      image properties.
    </p>
</div>
<div class="refsect1">
<a name="using-C-ref"></a><h2>Reference counting</h2>
<p>
      VIPS is based on the <a href="http://library.gnome.org/devel/gobject/unstable/gobject-The-Base-Object-Type.html#GObject"><code class="literal">GObject</code></a> library and is therefore reference counted. 
      <a class="link" href="VipsImage.html#vips-image-new-from-file" title="vips_image_new_from_file ()"><code class="function">vips_image_new_from_file()</code></a> returns an object with a count of 1. 
      When you are done with an image, use <a href="http://library.gnome.org/devel/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref"><code class="function">g_object_unref()</code></a> to dispose of it. 
      If you pass an image to an operation and that operation needs to keep a 
      copy of the image, it will ref it. So you can unref an image as soon as 
      you no longer need it, you don't need to hang on to it in case anyone 
      else is still using it. 
    </p>
<p>
      See <a class="link" href="VipsOperation.html" title="VipsOperation"><span class="type">VipsOperation</span></a> for more detail on VIPS 
      reference counting conventions.
    </p>
</div>
<div class="refsect1">
<a name="using-C-operations"></a><h2>VIPS operations</h2>
<p>
      Use things like <a class="link" href="libvips-arithmetic.html#vips-invert" title="vips_invert ()"><code class="function">vips_invert()</code></a> to manipulate your images. See 
      <a class="link" href="VipsOperation.html" title="VipsOperation"><span class="type">VipsOperation</span></a> 
      for information on
      running operations on images. When you are done, you can write
      the final image to a disc file, to a formatted memory buffer, or to
      C-style memory array. See <a class="link" href="VipsImage.html#vips-image-write-to-file" title="vips_image_write_to_file ()"><code class="function">vips_image_write_to_file()</code></a> and friends.
    </p>
</div>
<div class="refsect1">
<a name="using-C-pixels"></a><h2>Getting pixels</h2>
<p>
      Use <a class="link" href="VipsRegion.html" title="VipsRegion"><span class="type">VipsRegion</span></a> to read pixels out of images. You can use 
      <a class="link" href="VipsImage.html#VIPS-IMAGE-ADDR:CAPS" title="VIPS_IMAGE_ADDR()"><code class="function">VIPS_IMAGE_ADDR()</code></a> as well, but this can need a large amount of 
      memory to work. See <a class="link" href="extending.html" title="Extending VIPS">extending</a> 
      for an introduction to writing your own operations. 
    </p>
</div>
<div class="refsect1">
<a name="using-C-errors"></a><h2>Error handling</h2>
<p>
      VIPS keeps a log of error message, see  <a class="link" href="libvips-error.html" title="error">VIPS Error</a> to find out how to get and
      clear the error log.
    </p>
</div>
<div class="refsect1">
<a name="using-C-example"></a><h2>Example</h2>
<div class="example">
<a name="id-1.2.4.10.2"></a><p class="title"><b>Example 1. VIPS from C example</b></p>
<div class="example-contents"><pre class="programlisting">
/* compile with:
 *
 *      gcc -g -Wall try211.c `pkg-config vips --cflags --libs`
 */

#include &lt;stdio.h&gt;
#include &lt;vips/vips.h&gt;

int
main( int argc, char **argv )
{
  GOptionContext *context;
  GOptionGroup *main_group;
  GError *error = NULL;
  VipsImage *in;
  double mean;
  VipsImage *out;

  if( VIPS_INIT( argv[0] ) )
    vips_error_exit( NULL ); 

  context = g_option_context_new( "hello infile outfile - VIPS demo" );

  main_group = g_option_group_new( NULL, NULL, NULL, NULL, NULL );
  g_option_context_set_main_group( context, main_group );
  vips_add_option_entries( main_group ); 

  if( !g_option_context_parse( context, &amp;argc, &amp;argv, &amp;error ) ) {
    if( error ) {
      fprintf( stderr, "%s\n", error-&gt;message );
      g_error_free( error );
    }

    vips_error_exit( NULL );
  }

  if( argc != 3 )
    vips_error_exit( "usage: %s infile outfile", argv[0] ); 
  
  if( !(in = vips_image_new_from_file( argv[1], NULL )) )
    vips_error_exit( NULL );

  printf( "image width = %d\n", vips_image_get_width( in ) ); 

  if( vips_avg( in, &amp;mean, NULL ) )
    vips_error_exit( NULL );

  printf( "mean pixel value = %g\n", mean ); 

  if( vips_invert( in, &amp;out, NULL ) )
    vips_error_exit( NULL );

  g_object_unref( in ); 

  if( vips_image_write_to_file( out, argv[2], NULL ) )
    vips_error_exit( NULL );

  g_object_unref( out ); 

  return( 0 );
}
</pre></div>
</div>
<br class="example-break">
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.20</div>
</body>
</html>